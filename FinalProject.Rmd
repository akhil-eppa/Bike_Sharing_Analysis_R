---
title: "Bike_Sharing_Project"
author: '@Akhil'
date: "27 February 2019"
output:
  html_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```





Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.

=========================================
Background 
=========================================

Bike sharing systems are new generation of traditional bike rentals where whole process from membership, rental and return 
back has become automatic. Through these systems, user is able to easily rent a bike from a particular position and return 
back at another position. Currently, there are about over 500 bike-sharing programs around the world which is composed of 
over 500 thousands bicycles. Today, there exists great interest in these systems due to their important role in traffic, 
environmental and health issues. 

Apart from interesting real world applications of bike sharing systems, the characteristics of data being generated by
these systems make them attractive for the research. Opposed to other transport services such as bus or subway, the duration
of travel, departure and arrival position is explicitly recorded in these systems. This feature turns bike sharing system into
a virtual sensor network that can be used for sensing mobility in the city. Hence, it is expected that most of important
events in the city could be detected via monitoring these data.

=========================================
Data Set
=========================================
Bike-sharing rental process is highly correlated to the environmental and seasonal settings. For instance, weather conditions,
precipitation, day of week, season, hour of the day, etc. can affect the rental behaviors. The core data set is related to  
the two-year historical log corresponding to years 2011 and 2012 from Capital Bikeshare system, Washington D.C., USA which is 
publicly available in http://capitalbikeshare.com/system-data. We aggregated the data on two hourly and daily basis and then 
extracted and added the corresponding weather and seasonal information. Weather information are extracted from http://www.freemeteo.com.

=========================================
Dataset characteristics
=========================================	
Both hour.csv and day.csv have the following fields, except hr which is not available in day.csv
	
	- instant: record index
	- dteday : date
	- season : season (1:springer, 2:summer, 3:fall, 4:winter)
	- yr : year (0: 2011, 1:2012)
	- mnth : month ( 1 to 12)
	- hr : hour (0 to 23)
	- holiday : weather day is holiday or not (extracted from http://dchr.dc.gov/page/holiday-schedule)
	- weekday : day of the week
	- workingday : if day is neither weekend nor holiday is 1, otherwise is 0.
	+ weathersit : 
		- 1: Clear, Few clouds, Partly cloudy, Partly cloudy
		- 2: Mist + Cloudy, Mist + Broken clouds, Mist + Few clouds, Mist
		- 3: Light Snow, Light Rain + Thunderstorm + Scattered clouds, Light Rain + Scattered clouds
		- 4: Heavy Rain + Ice Pallets + Thunderstorm + Mist, Snow + Fog
	- temp : Normalized temperature in Celsius. The values are divided to 41 (max)
	- atemp: Normalized feeling temperature in Celsius. The values are divided to 50 (max)
	- hum: Normalized humidity. The values are divided to 100 (max)
	- windspeed: Normalized wind speed. The values are divided to 67 (max)
	- casual: count of casual users
	- registered: count of registered users
	- cnt: count of total rental bikes including both casual and registered

Step1:
->Importing Dataset and splitting into test set and training set
->We remove attribute instant as it does not make any contribution to the predictions
->odata is original dataset while data is modified dataset
```{r}
odata=read.csv("D:/Study/PESU IO Data_Analytics_with_R/Final_Project/day.csv")
data=odata[,-1]
data=data[,-1]
set.seed(123)
split = sample.split(data$cnt, SplitRatio = 0.8)
training_set=subset(data,split==TRUE)
test_set=subset(data,split==FALSE)
```

```{r}
print(min(data$cnt))
trial=odata[order(odata$cnt,decreasing = FALSE),]
print(trial[1,])
```
29/10/2012- Hurricane Sandy
===========================================================================================================================================
->Step2:Visualising data before we proceed to start working with it
Plot1: Total Count of rental bikes vs Date
```{r}
plot_ly(odata,x= ~odata$dteday,y= ~odata$cnt,type="bar")
```
On some days bike count falls to a very low value,we need to analyse why? The count of bikes depends on what factors exactly?

Plot 2: Total count of bikes vs whether day is a holiday or not

```{r}
plot_ly(data,x= ~data$holiday,y= ~data$cnt,type="bar")#Holiday vs count
plot_ly(data,x= ~data$workingday,y= ~data$cnt,type="bar")#Whether working day vs count
```

Plot 3:Total count of bikes vs Temperature on that day

```{r}
plot_ly(data,x= ~data$temp,y= ~data$cnt,type="bar",color="red")
```
From the above plot one can conclude that when temperatures are low, lesser bikes are rented and while temperatures are moderate the bike count is at its peak

Plot 4:Total count of bikes vs Weather conditions


```{r}
plot_ly(data,x= ~data$weathersit,y= ~data$cnt,type="bar")
```
- 1: Clear, Few clouds, Partly cloudy, Partly cloudy
- 2: Mist + Cloudy, Mist + Broken clouds, Mist + Few clouds, Mist
- 3: Light Snow, Light Rain + Thunderstorm + Scattered clouds, Light Rain + Scattered clouds
Some more additional plots:

```{r}
plot_ly(data,x=~data$windspeed,y=~data$cnt,type="bar")
```
```{r}
plot_ly(data,x=~data$hum,y=~data$cnt,type="bar")
```


```{r}
plot_ly(data,x=~data$workingday,y=~data$cnt,type="box")
```
```{r}
plot_ly(data,x=~data$season,y=~data$cnt,type="box")
```

season (1:springer, 2:summer, 3:fall, 4:winter)
===========================================================================================================================================
=============================================================================================================
Conclusion:From all the above plots we can come to the conclusion that the count of bikes is not dependent on
just a single factor but is dependent on several factors. Hence we need to build a suitable model that takes 
all these factors into account and gives us the best predictions.
=============================================================================================================

Step 3: Plotting the correlation matrix to remove redundant elements
```{r}
print(data.frame(cor(data)))#Converting correlation matrix to a dataframe
corrplot(cor(data))
```

Lets set our threshold correlation value as 0.8 or 80% and hence decide what all parameters we may drop:

mnth --- season ---->0.831440114
temp --- atemp ---->0.9917015532

We cannot consider correlation of registered and cnt as cnt is the dependent variable that we need to predict.

Conclusion:
We shall drop attributes mnth and atemp and not consider them in building our regressor
```{r}
data=data[,-3]
```
```{r}
data=data[,-8]
```
===========================================================================================================================================

Step 4: Building the regressor model
We shall remove columns of casual and registered users on a particular day as these are factors that can be found only after the day has passed only.

Removing Casual User Column:
```{r}
data=data[,-10]
```

Removing Registered User Column:
```{r}
data=data[,-10]
```

```{r}
regressor=lm(formula = cnt~season+yr+holiday+weekday+workingday+weathersit+temp+hum+windspeed,data=training_set)
#regressor=lm(formula = cnt~registered,data=training_set)
summary(regressor)
y_pred=predict(regressor,newdata=test_set)
rmse(test_set$cnt,y_pred)
```


```{r}
plot(regressor)
```
```{r}
library(ggplot2)
ggplot() +
  geom_point(aes(x = c(1:147), y = test_set$cnt),
             colour = 'red') +
  geom_point(aes(x = c(1:147), y = predict(regressor, newdata = test_set)),
            colour = 'blue') +
  ggtitle('Performance of model') +
  xlab('Instances of test_set') +
  ylab('Count of bikes')
```

The blue dots represnt what our model predicted for each instance of the test_set and the red dots represent what the actual values were for the test_set instances
=========================================================================================================================================

```{r}
data$temp2=data$temp^2
data$temp3=data$temp^3
data$temp4=data$temp^4
data$temp5=data$temp^5
data$temp6=data$temp^6
data$temp6=data$temp^7
data$weathersit2=data$weathersit^2
data$season2=data$season^2
data$season3=data$season^3
training_set2=subset(data,split==TRUE)
test_set2=subset(data,split==FALSE)
poly_reg=lm(formula=cnt ~.,data=training_set2)
summary(poly_reg)
y_pred2=predict(poly_reg,newdata=test_set2)
rmse(test_set2$cnt,y_pred2)
```
```{r}
plot(poly_reg)
```

```{r}
ggplot() +
  geom_point(aes(x = c(1:147), y = test_set2$cnt),
             colour = 'red') +
  geom_point(aes(x = c(1:147), y = predict(poly_reg, newdata = test_set2)),
            colour = 'blue') +
  ggtitle('Performance of model') +
  xlab('Instances of test_set') +
  ylab('Count of bikes')
```

